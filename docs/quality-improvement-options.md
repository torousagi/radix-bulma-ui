# radix-bulma 品質向上オプション

「中小企業案件で動けばいい」レベルから品質を向上させる場合の選択肢をまとめた資料です。

---

## 1. 優先度サマリー

| 順位 | 項目 | 優先度 | 工数 | 効果 | ROI |
|------|------|--------|------|------|-----|
| 1 | **テスト追加** | 高 | 40-50時間 | 高 | 良好 |
| 2 | **TypeScript化** | 中-高 | 10-12時間 | 中-高 | 良好 |
| 3 | **エラーバウンダリ** | 中 | 2-3時間 | 中 | 良好 |
| 4 | **アクセシビリティ監査** | 中-高 | 13時間 | 中-高 | 案件次第 |
| 5 | **ドキュメント整備** | 低-中 | 13-19時間 | 中 | チーム規模次第 |
| 6 | **Storybook導入** | 低-中 | 8-13時間 | 中 | デザイナー有無次第 |
| 7 | **パフォーマンス最適化** | 低 | 9-10時間 | 低 | 不良 |
| 8 | **PropTypes追加** | 低 | 3-6時間 | 低 | 不良 |

---

## 2. 各オプションの詳細

### 2.1 テスト追加（優先度：高）

#### 概要
現状テストがないため、回帰テストの手段がない。Portalを使うコンポーネントの動作も未検証。

#### 工数
| レベル | 内容 | 工数 |
|--------|------|------|
| 基本動作テスト | 各コンポーネント2-3ケース | 40時間 |
| +アクセシビリティテスト | キーボード操作、ARIA属性 | +25時間 |
| +E2Eテスト | Playwright/Cypress | +40時間 |

#### 効果
- 本番バグ率 **50-70%低下**
- 安全なリファクタリングが可能
- 「テスト済み」という顧客への安心感

#### 必要なツール
```json
{
  "devDependencies": {
    "@testing-library/react": "^14.0.0",
    "@testing-library/jest-dom": "^6.0.0",
    "vitest": "^0.34.0"
  }
}
```

#### こんな案件で必要
- 本番環境での品質要件が高い
- 継続的なメンテナンスが予想される
- 複数の利用者による使用

---

### 2.2 TypeScript化（優先度：中-高）

#### 概要
現状のJSXをTSXに変換し、型安全性を確保。

#### 工数
| 作業 | 工数 |
|------|------|
| tsconfig.json設定、型定義ファイル作成 | 1-2時間 |
| 単純コンポーネント（5個） | 2.5時間 |
| 複雑コンポーネント（4個） | 6時間 |
| **合計** | **10-12時間** |

#### 効果
- IDE補完で開発速度 **30-40%向上**
- プロパティタイプミスの早期発見
- 将来のリファクタリングが安全

#### 型定義例
```typescript
interface DialogTriggerProps {
  children?: ReactNode
  variant?: 'primary' | 'info' | 'success' | 'warning' | 'danger' | 'light' | 'dark'
  size?: 'small' | 'normal' | 'medium' | 'large'
  className?: string
}
```

#### こんな案件で必要
- 2人以上のチーム開発
- 予定期間が3ヶ月以上
- 定期的なメンテナンスが予想される

---

### 2.3 エラーバウンダリ（優先度：中）

#### 概要
Portal使用コンポーネント（Dialog、Select、Toast等8個）でエラーが発生した際、アプリ全体がクラッシュするのを防ぐ。

#### 工数
**2-3時間**（実装 + 統合テスト）

#### 実装例
```javascript
// components/ErrorBoundary.jsx
import { Component } from 'react'

export class ErrorBoundary extends Component {
  state = { hasError: false }

  static getDerivedStateFromError() {
    return { hasError: true }
  }

  componentDidCatch(error, errorInfo) {
    console.error('Error caught:', error, errorInfo)
  }

  render() {
    if (this.state.hasError) {
      return <div className="notification is-danger">エラーが発生しました</div>
    }
    return this.props.children
  }
}
```

#### 効果
- Portal内のエラーをキャッチし、全体崩壊を防止
- デバッグ効率向上（エラーログが明確）

#### こんな案件で必要
- Dialog/Toast内で複雑な処理を行う
- 本番環境での安全性を重視

---

### 2.4 アクセシビリティ監査（優先度：中-高）

#### 概要
Radix UIが基本的なアクセシビリティを提供しているが、追加で確認・改善すべき点がある。

#### 監査項目と工数
| 項目 | 工数 |
|------|------|
| カラーコントラスト比（WCAG AA基準）確認 | 1時間 |
| フォーカス表示（`:focus-visible`）追加 | 1時間 |
| キーボード操作の手動テスト | 4時間 |
| スクリーンリーダー（NVDA/JAWS）テスト | 4時間 |
| ARIA属性の確認・追加 | 2時間 |
| `prefers-reduced-motion` 対応 | 1.5時間 |
| **合計** | **13時間** |

#### 効果
- 障害者差別解消法への準拠
- 視覚障害者、高齢者が利用可能に
- 官公庁・大企業との取引条件を満たす

#### こんな案件で必要
- 官公庁・金融機関との取引
- 一般公開型のWebサービス
- SaaS/プラットフォーム

---

### 2.5 ドキュメント整備（優先度：低-中）

#### 概要
現状は比較ドキュメント（本ファイル）のみ。README、JSDoc、API仕様がない。

#### 工数
| ドキュメント | 工数 |
|-------------|------|
| README.md | 1.5-2時間 |
| JSDoc（全コンポーネント） | 4-6時間 |
| コンポーネントAPI仕様書 | 6-8時間 |
| スタイルカスタマイズガイド | 2-3時間 |
| **合計** | **13-19時間** |

#### 効果
| ドキュメント | 効果 |
|------------|------|
| README | 新規開発者のオンボーディング時間 **20-30%削減** |
| JSDoc | IDE補完・クイックリファレンス |
| API仕様書 | 仕様確認・統合開発 **15-25%効率化** |
| カスタマイズガイド | デザイン調整時間 **30-40%削減** |

#### こんな案件で必要
- チーム規模が大きい（5名以上）
- 人員の入れ替わりがある
- 長期メンテナンスが予想される

---

### 2.6 Storybook導入（優先度：低-中）

#### 概要
UIコンポーネントをカタログ化し、ブラウザで独立実行・確認できるツール。

#### 工数
| 作業 | 工数 |
|------|------|
| セットアップ | 2-3時間 |
| 各コンポーネントのStory作成（19個） | 6-10時間 |
| **合計** | **8-13時間** |

#### 効果
| 場面 | 効果 |
|------|------|
| デザイナーとのレビュー | 時間 **80%短縮** |
| 新しい開発者のオンボーディング | 使用例が明確 |
| コンポーネント変更前後の比較 | 視覚的に確認可能 |

#### デメリット
- メンテナンスコスト（コンポーネント変更時にStory更新が必要）
- 初回ビルド2-3分

#### こんな案件で必要
- デザイナーを含むチーム開発
- コンポーネントの再利用が多い
- UIの品質が重要

---

### 2.7 パフォーマンス最適化（優先度：低）

#### 概要
React.memo、useCallback最適化、CSSアニメーション最適化など。

#### 工数
| 改善項目 | 工数 | 効果 |
|---------|------|------|
| React.memo導入 | 2時間 | 5-10% |
| useCallback最適化 | 2時間 | 3-5% |
| ID生成の最適化（UUID lib） | 1時間 | SSR対応 |
| CSSアニメーション最適化 | 1.5時間 | モバイルで20% |
| バンドルサイズ最適化 | 3時間 | 30-40%削減 |
| **合計** | **9-10時間** | |

#### 効果
- デスクトップ: 改善効果 **2-5%**（計測困難）
- モバイル: 改善効果 **10-25%**
- 低スペック環境: 改善効果 **20-30%**

#### こんな案件で必要
- 東アジア向けサービス（低スペック端末が多い）
- 大規模データを扱うダッシュボード
- 高頻度更新が必要なUI

**判定**: 他の改善に比べて効果が限定的。後回しで良い。

---

### 2.8 PropTypes追加（優先度：低）

#### 概要
TypeScriptの代替として、ランタイムで型チェックを行う。

#### 工数
**3-6時間**

#### TypeScriptとの比較
| 観点 | PropTypes | TypeScript |
|------|-----------|-----------|
| 導入難易度 | 低 | 中 |
| IDE補完 | なし | あり |
| ビルド時チェック | なし | あり |
| 保守性 | 低 | 高 |

**判定**: TypeScript化を選択した場合は不要。効果が限定的。

---

## 3. 案件規模別の推奨パッケージ

### シナリオA: 小規模（1-2名、3ヶ月以下）

```
実施項目:
1. テスト（基本動作のみ）- 40時間
2. TypeScript化 - 12時間

合計: 52時間（約2.5週間）
期待効果: バグ減、開発速度向上、型安全性確保
```

### シナリオB: 中規模（3-5名、3-12ヶ月）

```
実施項目:
1. テスト - 40時間
2. TypeScript化 - 12時間
3. エラーバウンダリ - 3時間
4. ドキュメント - 15時間
5. Storybook - 10時間

合計: 80時間（約4週間）
期待効果: 本格的な品質向上、チーム開発対応
```

### シナリオC: 官公庁・金融機関向け

```
実施項目:
1. アクセシビリティ監査 - 13時間（最優先）
2. テスト - 40時間
3. TypeScript化 - 12時間
4. ドキュメント - 15時間

合計: 80時間（約4週間）
期待効果: WCAG準拠、法的リスク排除
```

### シナリオD: 大規模（5名以上、12ヶ月以上）

```
実施項目: 全項目（パフォーマンス最適化、PropTypesを除く）

段階的に実施:
- フェーズ1: テスト + TypeScript + エラーバウンダリ（55時間）
- フェーズ2: ドキュメント + Storybook（25時間）
- フェーズ3: アクセシビリティ監査（13時間）

合計: 93時間（段階的実施）
期待効果: エンタープライズ品質、継続的改善体制
```

---

## 4. 実装フロー

```
プロジェクト開始
    │
    ▼
【要件確認】
├─ 本番環境で品質要件が高い？ → YES → テスト必須
├─ 複数人チーム？ → YES → TypeScript化推奨
├─ 官公庁・金融機関向け？ → YES → アクセシビリティ監査必須
├─ 長期メンテナンス予定？ → YES → ドキュメント必須
└─ デザイナー在籍？ → YES → Storybook推奨
    │
    ▼
【実装順序】
① テスト（基本動作）
    ↓
② TypeScript化
    ↓
③ エラーバウンダリ
    ↓
④ ドキュメント整備
    ↓
⑤ Storybook（オプション）
    ↓
⑥ アクセシビリティ監査（必要な案件のみ）
```

---

## 5. 具体的な改善ポイント

### 5.1 Checkbox.jsx - ID生成の改善

**現状（問題あり）**:
```javascript
const checkboxId = id || `checkbox-${Math.random().toString(36).substr(2, 9)}`
// SSR時に毎回異なるIDが生成される
```

**改善後**:
```javascript
import { useId } from 'react'

export function Checkbox({ label, className = '', id, ...props }) {
  const generatedId = useId()
  const checkboxId = id || generatedId
  // ...
}
```

### 5.2 Toast.jsx - キーの安全性改善

**現状（問題あり）**:
```javascript
const id = Date.now() // 重複の可能性あり
```

**改善後**:
```javascript
import { nanoid } from 'nanoid'

const addToast = useCallback(({ title, description, type = 'info', duration = 5000 }) => {
  const id = nanoid() // 一意かつ短いID
  // ...
}, [])
```

### 5.3 フォーカス表示の改善

**custom.css に追加**:
```css
button:focus-visible,
[role="menuitem"]:focus-visible,
[role="option"]:focus-visible {
  outline: 3px solid #3273dc;
  outline-offset: 2px;
}
```

---

## 6. まとめ

### 現状で十分なケース
- 社内システム（利用者が限定的）
- プロトタイプ・検証用
- 短期案件（3ヶ月以下）で単独開発

### 品質向上が必要なケース
- 一般公開するWebサービス
- 複数人でのチーム開発
- 長期メンテナンスが予想される
- 官公庁・金融機関との取引

### コスト効率の良い改善順序
1. **テスト**（効果大、必須に近い）
2. **TypeScript化**（開発効率向上）
3. **エラーバウンダリ**（低コスト高効果）
4. 以降は案件要件に応じて選択
